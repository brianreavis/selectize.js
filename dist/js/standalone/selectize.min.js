/*! selectize.js - v0.12.1 | https://github.com/brianreavis/selectize.js | Apache License (v2) */
(function(c,r){"function"===typeof define&&define.amd?define("sifter",r):"object"===typeof exports?module.exports=r():c.Sifter=r()})(this,function(){var c=function(c,m){this.items=c;this.settings=m||{diacritics:!0}};c.prototype.tokenize=function(c){c=(String(c||"").toLowerCase()+"").replace(/^\s+|\s+$|/g,"");if(!c||!c.length)return[];var m,e,f,u=[],n=c.split(/ +/);c=0;for(m=n.length;c<m;c++){e=(n[c]+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");if(this.settings.diacritics)for(f in v)v.hasOwnProperty(f)&&(e=e.replace(new RegExp(f,"g"),v[f]));u.push({string:n[c],regex:new RegExp(e,"i")})}return u};c.prototype.iterator=function(c,m){(p(c)?Array.prototype.forEach||function(c){for(var f=0,m=this.length;f<m;f++)c(this[f],f,this)}:function(c){for(var f in this)this.hasOwnProperty(f)&&c(this[f],f,this)}).apply(c,[m])};c.prototype.getScoreFunction=function(c,m){var e,f,u;c=this.prepareSearch(c,m);f=c.tokens;e=c.options.fields;u=f.length;var n=function(c,f){var e,m;if(!c)return 0;c=String(c||"");m=c.search(f.regex); if(-1===m)return 0;e=f.string.length/c.length;0===m&&(e+=.5);return e},p=function(){var c=e.length;return c?1===c?function(c,f){return n(f[e[0]],c)}:function(f,m){for(var u=0,D=0;u<c;u++)D+=n(m[e[u]],f);return D/c}:function(){return 0}}();return u?1===u?function(c){return p(f[0],c)}:"and"===c.options.conjunction?function(c){for(var e,m=0,n=0;m<u;m++){e=p(f[m],c);if(0>=e)return 0;n+=e}return n/u}:function(c){for(var e=0,m=0;e<u;e++)m+=p(f[e],c);return m/u}:function(){return 0}};c.prototype.getSortFunction=function(c,m){var e,f,n,p,x,v,w,B,C,A;n=this;c=n.prepareSearch(c,m);A=!c.query&&m.sort_empty||m.sort;C=function(c,f){return"$score"===c?f.score:n.items[f.id][c]};x=[];if(A)for(e=0,f=A.length;e<f;e++)(c.query||"$score"!==A[e].field)&&x.push(A[e]);if(c.query){A=!0;e=0;for(f=x.length;e<f;e++)if("$score"===x[e].field){A=!1;break}A&&x.unshift({field:"$score",direction:"desc"})}else for(e=0,f=x.length;e<f;e++)if("$score"===x[e].field){x.splice(e,1);break}B=[];e=0;for(f=x.length;e<f;e++)B.push("desc"=== x[e].direction?-1:1);return(v=x.length)?1===v?(p=x[0].field,w=B[0],function(c,f){return w*r(C(p,c),C(p,f))}):function(c,f){var a,b;for(a=0;a<v;a++)if(b=x[a].field,b=B[a]*r(C(b,c),C(b,f)))return b;return 0}:null};c.prototype.prepareSearch=function(c,m){if("object"===typeof c)return c;m=n({},m);var e=m.fields,f=m.sort,u=m.sort_empty;e&&!p(e)&&(m.fields=[e]);f&&!p(f)&&(m.sort=[f]);u&&!p(u)&&(m.sort_empty=[u]);return{options:m,query:String(c||"").toLowerCase(),tokens:this.tokenize(c),total:0,items:[]}}; c.prototype.search=function(c,m){var e,f,n,p;f=this.prepareSearch(c,m);m=f.options;c=f.query;p=m.score||this.getScoreFunction(f);c.length?this.iterator(this.items,function(c,n){e=p(c);(!1===m.filter||0<e)&&f.items.push({score:e,id:n})}):this.iterator(this.items,function(c,e){f.items.push({score:1,id:e})});(n=this.getSortFunction(f,m))&&f.items.sort(n);f.total=f.items.length;"number"===typeof m.limit&&(f.items=f.items.slice(0,m.limit));return f};var r=function(c,m){if("number"===typeof c&&"number"===typeof m)return c>m?1:c<m?-1:0;c=w(String(c||""));m=w(String(m||""));return c>m?1:m>c?-1:0},n=function(c,m){var e,f,n,p;e=1;for(f=arguments.length;e<f;e++)if(p=arguments[e])for(n in p)p.hasOwnProperty(n)&&(c[n]=p[n]);return c},p=Array.isArray||$&&$.isArray||function(c){return"[object Array]"===Object.prototype.toString.call(c)},v={a:"[a\u00c0\u00c1\u00c2\u00c3\u00c4\u00c5\u00e0\u00e1\u00e2\u00e3\u00e4\u00e5\u0100\u0101\u0105\u0104]",c:"[c\u00c7\u00e7\u0107\u0106\u010d\u010c]",d:"[d\u0111\u0110\u010f\u010e]", e:"[e\u00c8\u00c9\u00ca\u00cb\u00e8\u00e9\u00ea\u00eb\u011b\u011a\u0112\u0113\u0119\u0118]",i:"[i\u00cc\u00cd\u00ce\u00cf\u00ec\u00ed\u00ee\u00ef\u012a\u012b]",l:"[l\u0142\u0141]",n:"[n\u00d1\u00f1\u0148\u0147\u0144\u0143]",o:"[o\u00d2\u00d3\u00d4\u00d5\u00d5\u00d6\u00d8\u00f2\u00f3\u00f4\u00f5\u00f6\u00f8\u014c\u014d]",r:"[r\u0159\u0158]",s:"[s\u0160\u0161\u015b\u015a]",t:"[t\u0165\u0164]",u:"[u\u00d9\u00da\u00db\u00dc\u00f9\u00fa\u00fb\u00fc\u016f\u016e\u016a\u016b]",y:"[y\u0178\u00ff\u00fd\u00dd]",z:"[z\u017d\u017e\u017c\u017b\u017a\u0179]"},w=function(){var c,m,e,f,n="",p={};for(e in v)if(v.hasOwnProperty(e))for(f=v[e].substring(2,v[e].length-1),n+=f,c=0,m=f.length;c<m;c++)p[f.charAt(c)]=e;var r=new RegExp("["+n+"]","g");return function(c){return c.replace(r,function(c){return p[c]}).toLowerCase()}}();return c});
(function(c,r){"function"===typeof define&&define.amd?define("microplugin",r):"object"===typeof exports?module.exports=r():c.MicroPlugin=r()})(this,function(){var c={isArray:Array.isArray||function(c){return"[object Array]"===Object.prototype.toString.call(c)}};return{mixin:function(r){r.plugins={};r.prototype.initializePlugins=function(n){var p,r,w=[];this.plugins={names:[],settings:{},requested:{},loaded:{}};if(c.isArray(n))for(p=0,r=n.length;p<r;p++)"string"===typeof n[p]?w.push(n[p]):(this.plugins.settings[n[p].name]=
    n[p].options,w.push(n[p].name));else if(n)for(p in n)n.hasOwnProperty(p)&&(this.plugins.settings[p]=n[p],w.push(p));for(;w.length;)this.require(w.shift())};r.prototype.loadPlugin=function(c){var p=this.plugins,v=r.plugins[c];if(!r.plugins.hasOwnProperty(c))throw Error('Unable to find "'+c+'" plugin');p.requested[c]=!0;p.loaded[c]=v.fn.apply(this,[this.plugins.settings[c]||{}]);p.names.push(c)};r.prototype.require=function(c){var p=this.plugins;if(!this.plugins.loaded.hasOwnProperty(c)){if(p.requested[c])throw Error('Plugin has circular dependency ("'+
    c+'")');this.loadPlugin(c)}return p.loaded[c]};r.define=function(c,p){r.plugins[c]={name:c,fn:p}}}}});
(function(c,r){"function"===typeof define&&define.amd?define("selectize",["jquery","sifter","microplugin"],r):"object"===typeof exports?module.exports=r(require("jquery"),require("sifter"),require("microplugin")):c.Selectize=r(c.jQuery,c.Sifter,c.MicroPlugin)})(this,function(c,r,n){var p=function(a,b){if("string"!==typeof b||b.length){var d="string"===typeof b?new RegExp(b,"i"):b,c=function(a){var b=0;if(3===a.nodeType){var q=a.data.search(d);if(0<=q&&0<a.data.length){var l=a.data.match(d),b=document.createElement("span");
    b.className="highlight";a=a.splitText(q);a.splitText(l[0].length);q=a.cloneNode(!0);b.appendChild(q);a.parentNode.replaceChild(b,a);b=1}}else if(1===a.nodeType&&a.childNodes&&!/(script|style)/i.test(a.tagName))for(q=0;q<a.childNodes.length;++q)q+=c(a.childNodes[q]);return b};return a.each(function(){c(this)})}},v=function(){};v.prototype={on:function(a,b){this._events=this._events||{};this._events[a]=this._events[a]||[];this._events[a].push(b)},off:function(a,b){var d=arguments.length;if(0===d)return delete this._events;
    if(1===d)return delete this._events[a];this._events=this._events||{};!1!==a in this._events&&this._events[a].splice(this._events[a].indexOf(b),1)},trigger:function(a){this._events=this._events||{};if(!1!==a in this._events)for(var b=0;b<this._events[a].length;b++)this._events[a][b].apply(this,Array.prototype.slice.call(arguments,1))}};v.mixin=function(a){for(var b=["on","off","trigger"],d=0;d<b.length;d++)a.prototype[b[d]]=v.prototype[b[d]]};var w=/Mac/.test(navigator.userAgent),D=w?91:17,m=w?18:
    17,e=!/android/i.test(window.navigator.userAgent)&&!!document.createElement("form").validity,f=function(a){return"undefined"===typeof a||null===a?null:"boolean"===typeof a?a?"1":"0":a+""},u=function(a){return(a+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},E=function(a){return(a+"").replace(/\$/g,"$$$$")},x={before:function(a,b,d){var c=a[b];a[b]=function(){d.apply(a,arguments);return c.apply(a,arguments)}},after:function(a,b,d){var c=a[b];a[b]=function(){var b=
    c.apply(a,arguments);d.apply(a,arguments);return b}}},F=function(a){var b=!1;return function(){b||(b=!0,a.apply(this,arguments))}},G=function(a,b){var d;return function(){var c=this,g=arguments;window.clearTimeout(d);d=window.setTimeout(function(){a.apply(c,g)},b)}},B=function(a,b,d){var c,g=a.trigger,k={};a.trigger=function(){var d=arguments[0];if(-1!==b.indexOf(d))k[d]=arguments;else return g.apply(a,arguments)};d.apply(a,[]);a.trigger=g;for(c in k)k.hasOwnProperty(c)&&g.apply(a,k[c])},C=function(a,b,d,c){a.on(b,d,function(b){for(var d=b.target;d&&d.parentNode!==a[0];)d=d.parentNode;b.currentTarget=d;return c.apply(this,[b])})},A=function(a){var b={};if("selectionStart"in a)b.start=a.selectionStart,b.length=a.selectionEnd-b.start;else if(document.selection){a.focus();var d=document.selection.createRange(),c=document.selection.createRange().text.length;d.moveStart("character",-a.value.length);b.start=d.text.length-c;b.length=c}return b},H=function(a){var b=null,d=function(d,g){var k,q,l;d=d||window.event||{};g=g||{};if(!d.metaKey&&!d.altKey&&(g.force||!1!==a.data("grow"))){k=a.val();d.type&&"keydown"===d.type.toLowerCase()&&(q=d.keyCode,l=97<=q&&122>=q||65<=q&&90>=q||48<=q&&57>=q||32===q,46===q||8===q?(l=A(a[0]),l.length?k=k.substring(0,l.start)+k.substring(l.start+l.length):8===q&&l.start?k=k.substring(0,l.start-1)+k.substring(l.start+1):46===q&&"undefined"!==typeof l.start&&(k=k.substring(0,l.start)+k.substring(l.start+1))):l&&(q=d.shiftKey,l=String.fromCharCode(d.keyCode),l=q?l.toUpperCase():
    l.toLowerCase(),k+=l));q=a.attr("placeholder");!k&&q&&(k=q);if(k){k=c("<test>").css({position:"absolute",top:-99999,left:-99999,width:"auto",padding:0,whiteSpace:"pre"}).text(k).appendTo("body");q=["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"];var f,e={};if(q)for(l=0,f=q.length;l<f;l++)e[q[l]]=a.css(q[l]);else e=a.css();k.css(e);q=k.width();k.remove();k=q}else k=0;k+=4;k!==b&&(b=k,a.width(k),a.triggerHandler("resize"))}};a.on("keydown keyup update blur",d);d()},y=function(a,b){var d,h;d=a[0];d.selectize=this;h=(h=(h=window.getComputedStyle&&window.getComputedStyle(d,null))?h.getPropertyValue("direction"):d.currentStyle&&d.currentStyle.direction)||a.parents("[dir]:first").attr("dir")||"";c.extend(this,{order:0,settings:b,$input:a,tabIndex:a.attr("tabindex")||"",tagType:"select"===d.tagName.toLowerCase()?1:2,rtl:/rtl/i.test(h),eventNS:".selectize"+ ++y.count,highlightedValue:null,isOpen:!1,isDisabled:!1,isRequired:a.is("[required]"),isInvalid:!1,isLocked:!1,isFocused:!1,
    isInputHidden:!1,isSetup:!1,isShiftDown:!1,isCmdDown:!1,isCtrlDown:!1,ignoreFocus:!1,ignoreBlur:!1,ignoreHover:!1,hasOptions:!1,currentResults:null,lastValue:"",caretPos:0,loading:0,loadedSearches:{},$activeOption:null,$activeItems:[],optgroups:{},options:{},userOptions:{},items:[],renderCache:{},onSearchChange:null===b.loadThrottle?this.onSearchChange:G(this.onSearchChange,b.loadThrottle)});this.sifter=new r(this.options,{diacritics:b.diacritics});if(this.settings.options){d=0;for(h=this.settings.options.length;d<h;d++)this.registerOption(this.settings.options[d]);delete this.settings.options}if(this.settings.optgroups){d=0;for(h=this.settings.optgroups.length;d<h;d++)this.registerOptionGroup(this.settings.optgroups[d]);delete this.settings.optgroups}this.settings.mode=this.settings.mode||(1===this.settings.maxItems?"single":"multi");"boolean"!==typeof this.settings.hideSelected&&(this.settings.hideSelected="multi"===this.settings.mode);this.initializePlugins(this.settings.plugins);this.setupCallbacks();this.setupTemplates();
    this.setup()};v.mixin(y);n.mixin(y);c.extend(y.prototype,{setup:function(){var a=this,b=a.settings,d=a.eventNS,h=c(window),g=c(document),k=a.$input,q,l,f,p,n,z;n=a.settings.mode;z=k.attr("class")||"";q=c("<div>").addClass(b.wrapperClass).addClass(z).addClass(n);l=c("<div>").addClass(b.inputClass).addClass("items").appendTo(q);f=c('<input type="text" autocomplete="off" />').appendTo(l).attr("tabindex",k.is(":disabled")?"-1":a.tabIndex);p=c(b.dropdownParent||q);p=c("<div>").addClass(b.dropdownClass).addClass(n).hide().appendTo(p);
    n=c("<div>").addClass(b.dropdownContentClass).appendTo(p);l.addClass(a.settings.readOnly?"input-readonly":"");f.attr("readonly",a.settings.readOnly);a.settings.copyClassesToDropdown&&p.addClass(z);q.css({width:k[0].style.width});a.plugins.names.length&&(z="plugin-"+a.plugins.names.join(" plugin-"),q.addClass(z),p.addClass(z));(null===b.maxItems||1<b.maxItems)&&1===a.tagType&&k.attr("multiple","multiple");a.settings.placeholder&&f.attr("placeholder",b.placeholder);!a.settings.splitOn&&a.settings.delimiter&&(z=a.settings.delimiter.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),a.settings.splitOn=new RegExp("\\s*"+z+"+\\s*"));k.attr("autocorrect")&&f.attr("autocorrect",k.attr("autocorrect"));k.attr("autocapitalize")&&f.attr("autocapitalize",k.attr("autocapitalize"));a.$wrapper=q;a.$control=l;a.$control_input=f;a.$dropdown=p;a.$dropdown_content=n;p.on("mouseenter","[data-selectable]",function(){return a.onOptionHover.apply(a,arguments)});p.on("mousedown click","[data-selectable]",function(){return a.onOptionSelect.apply(a,arguments)});C(l,"mousedown","*:not(input)",function(){return a.onItemSelect.apply(a,arguments)});H(f);l.on({mousedown:function(){return a.onMouseDown.apply(a,arguments)},click:function(){return a.onClick.apply(a,arguments)}});f.on({mousedown:function(a){a.stopPropagation()},keydown:function(){return a.onKeyDown.apply(a,arguments)},keyup:function(){return a.onKeyUp.apply(a,arguments)},keypress:function(){return a.onKeyPress.apply(a,arguments)},resize:function(){a.positionDropdown.apply(a,[])},blur:function(){return a.onBlur.apply(a,
        arguments)},focus:function(){a.ignoreBlur=!1;return a.onFocus.apply(a,arguments)},paste:function(){return a.onPaste.apply(a,arguments)}});g.on("keydown"+d,function(b){a.isCmdDown=b[w?"metaKey":"ctrlKey"];a.isCtrlDown=b[w?"altKey":"ctrlKey"];a.isShiftDown=b.shiftKey});g.on("keyup"+d,function(b){b.keyCode===m&&(a.isCtrlDown=!1);16===b.keyCode&&(a.isShiftDown=!1);b.keyCode===D&&(a.isCmdDown=!1)});g.on("mousedown"+d,function(b){if(a.isFocused){if(b.target===a.$dropdown[0]||b.target.parentNode===a.$dropdown[0])return!1; a.$control.has(b.target).length||b.target===a.$control[0]||a.blur(b.target)}});h.on(["scroll"+d,"resize"+d].join(" "),function(){a.isOpen&&a.positionDropdown.apply(a,arguments)});h.on("mousemove"+d,function(){a.ignoreHover=!1});this.revertSettings={$children:k.children().detach(),tabindex:k.attr("tabindex")};k.attr("tabindex",-1).hide().after(a.$wrapper);c.isArray(b.items)&&(a.setValue(b.items),delete b.items);if(e)k.on("invalid"+d,function(b){b.preventDefault();a.isInvalid=!0;a.refreshState()});
    a.updateOriginalInput();a.refreshItems();a.refreshState();a.updatePlaceholder();a.isSetup=!0;k.is(":disabled")&&a.disable();a.on("change",this.onChange);k.data("selectize",a);k.addClass("selectized");a.trigger("initialize");if(!0===b.preload)a.onSearchChange("")},setupTemplates:function(){var a=this.settings.labelField,b=this.settings.optgroupLabelField;this.settings.render=c.extend({},{optgroup:function(a){return'<div class="optgroup">'+a.html+"</div>"},optgroup_header:function(a,c){return'<div class="optgroup-header">'+ c(a[b])+"</div>"},option:function(b,c){return'<div class="option">'+c(b[a])+"</div>"},item:function(b,c){return'<div class="item">'+c(b[a])+"</div>"},option_create:function(a,b){return'<div class="create">Add <strong>'+b(a.input)+"</strong>&hellip;</div>"}},this.settings.render)},setupCallbacks:function(){var a,b,d={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",
    optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(a in d)if(d.hasOwnProperty(a)&&(b=this.settings[d[a]]))this.on(a,b)},onClick:function(a){this.isFocused||(this.focus(),a.preventDefault())},onMouseDown:function(a){var b=this,d=a.isDefaultPrevented();c(a.target);if(b.isFocused){if(a.target!==b.$control_input[0])return"single"===
b.settings.mode?b.isOpen?b.close():b.open():d||b.setActiveItem(null),!1}else d||window.setTimeout(function(){b.focus()},0)},onChange:function(){this.$input.trigger("change")},onPaste:function(a){var b=this;b.isFull()||b.isInputHidden||b.isLocked?a.preventDefault():b.settings.splitOn&&setTimeout(function(){for(var a=c.trim(b.$control_input.val()||"").split(b.settings.splitOn),h=0,g=a.length;h<g;h++)b.createItem(a[h])},0)},onKeyPress:function(a){if(this.isLocked)return a&&a.preventDefault();var b=String.fromCharCode(a.keyCode|| a.which);if(this.settings.create&&"multi"===this.settings.mode&&b===this.settings.delimiter)return this.createItem(),a.preventDefault(),!1},onKeyDown:function(a){if(this.isLocked)9!==a.keyCode&&a.preventDefault();else{switch(a.keyCode){case 65:if(this.isCmdDown){this.selectAll();return}break;case 27:this.isOpen&&(a.preventDefault(),a.stopPropagation(),this.close());return;case 78:if(!a.ctrlKey||a.altKey)break;case 40:if(!this.isOpen&&this.hasOptions)this.open();else if(this.$activeOption){this.ignoreHover=
    !0;var b=this.getAdjacentOption(this.$activeOption,1);b.length&&this.setActiveOption(b,!0,!0)}a.preventDefault();return;case 80:if(!a.ctrlKey||a.altKey)break;case 38:this.$activeOption&&(this.ignoreHover=!0,b=this.getAdjacentOption(this.$activeOption,-1),b.length&&this.setActiveOption(b,!0,!0));a.preventDefault();return;case 13:this.isOpen&&this.$activeOption&&(this.onOptionSelect({currentTarget:this.$activeOption}),a.preventDefault());return;case 37:this.advanceSelection(-1,a);return;case 39:this.advanceSelection(1, a);return;case 9:this.settings.selectOnTab&&this.isOpen&&this.$activeOption&&(this.onOptionSelect({currentTarget:this.$activeOption}),this.isFull()||a.preventDefault());this.settings.create&&this.createItem()&&a.preventDefault();return;case 8:case 46:this.deleteSelection(a);return}!this.isFull()&&!this.isInputHidden||(w?a.metaKey:a.ctrlKey)||a.preventDefault()}},onKeyUp:function(a){if(this.isLocked)return a&&a.preventDefault();a=this.$control_input.val()||"";this.lastValue!==a&&(this.lastValue=a,this.onSearchChange(a),this.refreshOptions(),this.trigger("type",a))},onSearchChange:function(a){var b=this,d=b.settings.load;d&&!b.loadedSearches.hasOwnProperty(a)&&(b.loadedSearches[a]=!0,b.load(function(c){d.apply(b,[a,c])}))},onFocus:function(a){var b=this.isFocused;if(this.isDisabled)return this.blur(),a&&a.preventDefault(),!1;if(!this.ignoreFocus){this.isFocused=!0;if("focus"===this.settings.preload)this.onSearchChange("");b||this.trigger("focus");this.$activeItems.length||(this.showInput(),
    this.setActiveItem(null),this.refreshOptions(!!this.settings.openOnFocus));this.refreshState()}},onBlur:function(a,b){var d=this;if(d.isFocused&&(d.isFocused=!1,!d.ignoreFocus))if(d.ignoreBlur||document.activeElement!==d.$dropdown_content[0]){var c=function(){d.close();d.setTextboxValue("");d.setActiveItem(null);d.setActiveOption(null);d.setCaret(d.items.length);d.refreshState();(b||document.body).focus();d.ignoreFocus=!1;d.trigger("blur")};d.ignoreFocus=!0;d.settings.create&&d.settings.createOnBlur? d.createItem(null,!1,c):c()}else d.ignoreBlur=!0,d.onFocus(a)},onOptionHover:function(a){this.ignoreHover||this.setActiveOption(a.currentTarget,!1)},onOptionSelect:function(a){var b,d=this;a.preventDefault&&(a.preventDefault(),a.stopPropagation());b=c(a.currentTarget);b.hasClass("create")?d.createItem(null,function(){d.settings.closeAfterSelect&&d.close()}):(b=b.attr("data-value"),"undefined"!==typeof b&&(d.lastQuery=null,d.setTextboxValue(""),d.addItem(b),d.settings.closeAfterSelect?d.close():!d.settings.hideSelected&&
a.type&&/mouse/.test(a.type)&&d.setActiveOption(d.getOption(b))))},onItemSelect:function(a){this.isLocked||"multi"!==this.settings.mode||(a.preventDefault(),this.setActiveItem(a.currentTarget,a))},load:function(a){var b=this,d=b.$wrapper.addClass(b.settings.loadingClass);b.loading++;a.apply(b,[function(a){b.loading=Math.max(b.loading-1,0);a&&a.length&&(b.addOption(a),b.refreshOptions(b.isFocused&&!b.isInputHidden));b.loading||d.removeClass(b.settings.loadingClass);b.trigger("load",a)}])},setTextboxValue:function(a){var b=this.$control_input;b.val()!==a&&(b.val(a).triggerHandler("update"),this.lastValue=a)},getValue:function(){return 1===this.tagType&&this.$input.attr("multiple")?this.items:this.items.join(this.settings.delimiter)},setValue:function(a,b){B(this,b?[]:["change"],function(){this.clear(b);this.addItems(a,b)})},setActiveItem:function(a,b){var d,h,g;if("single"!==this.settings.mode)if(a=c(a),a.length){d=b&&b.type.toLowerCase();if("mousedown"===d&&this.isShiftDown&&this.$activeItems.length){d=this.$control.children(".active:last");
    h=Array.prototype.indexOf.apply(this.$control[0].childNodes,[d[0]]);d=Array.prototype.indexOf.apply(this.$control[0].childNodes,[a[0]]);h>d&&(g=h,h=d,d=g);for(;h<=d;h++)g=this.$control[0].childNodes[h],-1===this.$activeItems.indexOf(g)&&(c(g).addClass("active"),this.$activeItems.push(g));b.preventDefault()}else"mousedown"===d&&this.isCtrlDown||"keydown"===d&&this.isShiftDown?a.hasClass("active")?(d=this.$activeItems.indexOf(a[0]),this.$activeItems.splice(d,1),a.removeClass("active")):this.$activeItems.push(a.addClass("active")[0]):
    (c(this.$activeItems).removeClass("active"),this.$activeItems=[a.addClass("active")[0]]);this.hideInput();this.isFocused||this.focus()}else c(this.$activeItems).removeClass("active"),this.$activeItems=[],this.isFocused&&this.showInput()},setActiveOption:function(a,b,d){var h,g,k;this.$activeOption&&this.$activeOption.removeClass("active");this.$activeOption=null;a=c(a);a.length&&(this.$activeOption=a.addClass("active"),b||"undefined"===typeof b)&&(a=this.$dropdown_content.height(),h=this.$activeOption.outerHeight(!0), b=this.$dropdown_content.scrollTop()||0,g=this.$activeOption.offset().top-this.$dropdown_content.offset().top+b,k=g-a+h,g+h>a+b?this.$dropdown_content.stop().animate({scrollTop:k},d?this.settings.scrollDuration:0):g<b&&this.$dropdown_content.stop().animate({scrollTop:g},d?this.settings.scrollDuration:0))},selectAll:function(){"single"!==this.settings.mode&&(this.$activeItems=Array.prototype.slice.apply(this.$control.children(":not(input)").addClass("active")),this.$activeItems.length&&(this.hideInput(), this.close()),this.focus())},hideInput:function(){this.setTextboxValue("");this.$control_input.css({opacity:0,position:"absolute",left:this.rtl?1E4:-1E4});this.isInputHidden=!0},showInput:function(){this.$control_input.css({opacity:1,position:"relative",left:0});this.isInputHidden=!1},focus:function(){var a=this;a.isDisabled||(a.ignoreFocus=!0,a.$control_input[0].focus(),window.setTimeout(function(){a.ignoreFocus=!1;a.onFocus()},0))},blur:function(a){this.$control_input[0].blur();this.onBlur(null,
    a)},getScoreFunction:function(a){return this.sifter.getScoreFunction(a,this.getSearchOptions())},getSearchOptions:function(){var a=this.settings,b=a.sortField;"string"===typeof b&&(b=[{field:b}]);return{fields:a.searchField,conjunction:a.searchConjunction,sort:b}},search:function(a){var b,d;b=this.settings;var h=this.getSearchOptions();if(b.score&&(d=this.settings.score.apply(this,[a]),"function"!==typeof d))throw Error('Selectize "score" setting must be a function that returns a function');a!==this.lastQuery? (this.lastQuery=a,this.currentResults=a=this.sifter.search(a,c.extend(h,{score:d}))):a=c.extend(!0,{},this.currentResults);if(b.hideSelected)for(b=a.items.length-1;0<=b;b--)-1!==this.items.indexOf(f(a.items[b].id))&&a.items.splice(b,1);return a},refreshOptions:function(a){var b,d,h,g,k,q,l,e,m,n,z,r;"undefined"===typeof a&&(a=!0);var t=this;z=c.trim(t.$control_input.val());var u=t.search(z),v=t.$dropdown_content,w=t.$activeOption&&f(t.$activeOption.attr("data-value"));g=u.items.length;"number"===typeof t.settings.maxOptions&&(g=Math.min(g,t.settings.maxOptions));k={};q=[];for(b=0;b<g;b++)for(l=t.options[u.items[b].id],e=t.render("option",l),l=l[t.settings.optgroupField]||"",m=c.isArray(l)?l:[l],d=0,h=m&&m.length;d<h;d++)l=m[d],t.optgroups.hasOwnProperty(l)||(l=""),k.hasOwnProperty(l)||(k[l]=[],q.push(l)),k[l].push(e);this.settings.lockOptgroupOrder&&q.sort(function(a,b){return(t.optgroups[a].$order||0)-(t.optgroups[b].$order||0)});e=[];b=0;for(g=q.length;b<g;b++)l=q[b],t.optgroups.hasOwnProperty(l)&&
k[l].length?(d=t.render("optgroup_header",t.optgroups[l])||"",d+=k[l].join(""),e.push(t.render("optgroup",c.extend({},t.optgroups[l],{html:d})))):e.push(k[l].join(""));v.html(e.join(""));if(t.settings.highlight&&u.query.length&&u.tokens.length)for(b=0,g=u.tokens.length;b<g;b++)p(v,u.tokens[b].regex);if(!t.settings.hideSelected)for(b=0,g=t.items.length;b<g;b++)t.getOption(t.items[b]).addClass("selected");if(b=t.canCreate(z))v.prepend(t.render("option_create",{input:z})),r=c(v[0].childNodes[0]);t.hasOptions= 0<u.items.length||b;t.hasOptions?(0<u.items.length?((z=w&&t.getOption(w))&&z.length?n=z:"single"===t.settings.mode&&t.items.length&&(n=t.getOption(t.items[0])),n&&n.length||(n=r&&!t.settings.addPrecedence?t.getAdjacentOption(r,1):v.find("[data-selectable]:first"))):n=r,t.setActiveOption(n),a&&!t.isOpen&&t.open()):(t.setActiveOption(null),a&&t.isOpen&&t.close())},addOption:function(a){var b,d;if(c.isArray(a))for(b=0,d=a.length;b<d;b++)this.addOption(a[b]);else if(b=this.registerOption(a))this.userOptions[b]= !0,this.lastQuery=null,this.trigger("option_add",b,a)},registerOption:function(a){var b=f(a[this.settings.valueField]);if(!b||this.options.hasOwnProperty(b))return!1;a.$order=a.$order||++this.order;this.options[b]=a;return b},registerOptionGroup:function(a){var b=f(a[this.settings.optgroupValueField]);if(!b)return!1;a.$order=a.$order||++this.order;this.optgroups[b]=a;return b},addOptionGroup:function(a,b){b[this.settings.optgroupValueField]=a;(a=this.registerOptionGroup(b))&&this.trigger("optgroup_add",
    a,b)},removeOptionGroup:function(a){this.optgroups.hasOwnProperty(a)&&(delete this.optgroups[a],this.renderCache={},this.trigger("optgroup_remove",a))},clearOptionGroups:function(){this.optgroups={};this.renderCache={};this.trigger("optgroup_clear")},updateOption:function(a,b){var d,h,g;a=f(a);d=f(b[this.settings.valueField]);if(null!==a&&this.options.hasOwnProperty(a)){if("string"!==typeof d)throw Error("Value must be set in option data");g=this.options[a].$order;d!==a&&(delete this.options[a],h= this.items.indexOf(a),-1!==h&&this.items.splice(h,1,d));b.$order=b.$order||g;this.options[d]=b;h=this.renderCache.item;g=this.renderCache.option;h&&(delete h[a],delete h[d]);g&&(delete g[a],delete g[d]);-1!==this.items.indexOf(d)&&(d=this.getItem(a),h=c(this.render("item",b)),d.hasClass("active")&&h.addClass("active"),d.replaceWith(h));this.lastQuery=null;this.isOpen&&this.refreshOptions(!1)}},removeOption:function(a,b){a=f(a);var d=this.renderCache.item,c=this.renderCache.option;d&&delete d[a];c&&delete c[a];delete this.userOptions[a];delete this.options[a];this.lastQuery=null;this.trigger("option_remove",a);this.removeItem(a,b)},clearOptions:function(){this.loadedSearches={};this.userOptions={};this.renderCache={};this.options=this.sifter.items={};this.lastQuery=null;this.trigger("option_clear");this.clear()},getOption:function(a){return this.getElementWithValue(a,this.$dropdown_content.find("[data-selectable]"))},getAdjacentOption:function(a,b){var d=this.$dropdown.find("[data-selectable]"),
    h=d.index(a)+b;return 0<=h&&h<d.length?d.eq(h):c()},getElementWithValue:function(a,b){a=f(a);if("undefined"!==typeof a&&null!==a)for(var d=0,h=b.length;d<h;d++)if(b[d].getAttribute("data-value")===a)return c(b[d]);return c()},getItem:function(a){return this.getElementWithValue(a,this.$control.children())},addItems:function(a,b){for(var d=c.isArray(a)?a:[a],h=0,g=d.length;h<g;h++)this.isPending=h<g-1,this.addItem(d[h],b)},addItem:function(a,b){B(this,b?[]:["change"],function(){var d,h,g,k=this.settings.mode; a=f(a);-1!==this.items.indexOf(a)?"single"===k&&this.close():this.options.hasOwnProperty(a)&&("single"===k&&this.clear(b),"multi"===k&&this.isFull()||(d=c(this.render("item",this.options[a])),g=this.isFull(),this.items.splice(this.caretPos,0,a),this.insertAtCaret(d),(!this.isPending||!g&&this.isFull())&&this.refreshState(),this.isSetup&&(g=this.$dropdown_content.find("[data-selectable]"),this.isPending||(h=this.getOption(a),h=this.getAdjacentOption(h,1).attr("data-value"),this.refreshOptions(this.isFocused&&
        "single"!==k),h&&this.setActiveOption(this.getOption(h))),!g.length||this.isFull()?this.close():this.positionDropdown(),this.updatePlaceholder(),this.trigger("item_add",a,d),this.updateOriginalInput({silent:b}))))})},removeItem:function(a,b){var d,c,g;d="object"===typeof a?a:this.getItem(a);a=f(d.attr("data-value"));c=this.items.indexOf(a);-1!==c&&(d.remove(),d.hasClass("active")&&(g=this.$activeItems.indexOf(d[0]),this.$activeItems.splice(g,1)),this.items.splice(c,1),this.lastQuery=null,!this.settings.persist&&
this.userOptions.hasOwnProperty(a)&&this.removeOption(a,b),c<this.caretPos&&this.setCaret(this.caretPos-1),this.refreshState(),this.updatePlaceholder(),this.updateOriginalInput({silent:b}),this.positionDropdown(),this.trigger("item_remove",a,d))},createItem:function(a,b){var d=this,h=d.caretPos;a=a||c.trim(d.$control_input.val()||"");var g=arguments[arguments.length-1];"function"!==typeof g&&(g=function(){});"boolean"!==typeof b&&(b=!0);if(!d.canCreate(a))return g(),!1;d.lock();var k="function"===typeof d.settings.create?this.settings.create:function(a){var b={};b[d.settings.labelField]=a;b[d.settings.valueField]=a;return b},q=F(function(a){d.unlock();if(!a||"object"!==typeof a)return g();var c=f(a[d.settings.valueField]);if("string"!==typeof c)return g();d.setTextboxValue("");d.addOption(a);d.setCaret(h);d.addItem(c);d.refreshOptions(b&&"single"!==d.settings.mode);g(a)}),k=k.apply(this,[a,q]);"undefined"!==typeof k&&q(k);return!0},refreshItems:function(){this.lastQuery=null;this.isSetup&&
this.addItem(this.items);this.refreshState();this.updateOriginalInput()},refreshState:function(){this.isRequired&&(this.items.length&&(this.isInvalid=!1),this.$control_input.prop("required",void 0));this.refreshClasses()},refreshClasses:function(){var a=this.isFull(),b=this.isLocked;this.$wrapper.toggleClass("rtl",this.rtl);this.$control.toggleClass("focus",this.isFocused).toggleClass("disabled",this.isDisabled).toggleClass("required",this.isRequired).toggleClass("invalid",this.isInvalid).toggleClass("locked",b).toggleClass("full",a).toggleClass("not-full",!a).toggleClass("input-active",this.isFocused&&!this.isInputHidden).toggleClass("dropdown-active",this.isOpen).toggleClass("has-options",!c.isEmptyObject(this.options)).toggleClass("has-items",0<this.items.length);this.$control_input.data("grow",!a&&!b)},isFull:function(){return null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems},updateOriginalInput:function(a){var b,d,c,g;a=a||{};if(1===this.tagType){c=[];b=0;for(d=this.items.length;b<
d;b++)g=this.options[this.items[b]][this.settings.labelField]||"",c.push('<option value="'+u(this.items[b])+'" selected="selected">'+u(g)+"</option>");c.length||this.$input.attr("multiple")||c.push('<option value="" selected="selected"></option>');this.$input.html(c.join(""))}else this.$input.val(this.getValue()),this.$input.attr("value",this.$input.val());this.isSetup&&(a.silent||this.trigger("change",this.$input.val()))},updatePlaceholder:function(){if(this.settings.placeholder){var a=this.$control_input; this.items.length?a.removeAttr("placeholder"):a.attr("placeholder",this.settings.placeholder);a.triggerHandler("update",{force:!0})}},open:function(){this.isLocked||this.isOpen||"multi"===this.settings.mode&&this.isFull()||(this.focus(),this.isOpen=!0,this.refreshState(),this.$dropdown.css({visibility:"hidden",display:"block"}),this.positionDropdown(),this.$dropdown.css({visibility:"visible"}),this.trigger("dropdown_open",this.$dropdown))},close:function(){var a=this.isOpen;"single"===this.settings.mode&&
this.items.length&&this.hideInput();this.isOpen=!1;this.$dropdown.hide();this.setActiveOption(null);this.refreshState();a&&this.trigger("dropdown_close",this.$dropdown)},positionDropdown:function(){var a=this.$control,b="body"===this.settings.dropdownParent?a.offset():a.position();b.top+=a.outerHeight(!0);this.$dropdown.css({width:a.outerWidth(),top:b.top,left:b.left})},clear:function(a){this.items.length&&(this.$control.children(":not(input)").remove(),this.items=[],this.lastQuery=null,this.setCaret(0),this.setActiveItem(null),this.updatePlaceholder(),this.updateOriginalInput({silent:a}),this.refreshState(),this.showInput(),this.trigger("clear"))},insertAtCaret:function(a){var b=Math.min(this.caretPos,this.items.length);0===b?this.$control.prepend(a):c(this.$control[0].childNodes[b]).before(a);this.setCaret(b+1)},deleteSelection:function(a){var b,d,h,g,k;b=a&&8===a.keyCode?-1:1;d=A(this.$control_input[0]);this.$activeOption&&!this.settings.hideSelected&&(k=this.getAdjacentOption(this.$activeOption,-1).attr("data-value"));h=[];if(this.$activeItems.length){g=this.$control.children(".active:"+(0<b?"last":"first"));g=this.$control.children(":not(input)").index(g);0<b&&g++;b=0;for(d=this.$activeItems.length;b<d;b++)h.push(c(this.$activeItems[b]).attr("data-value"));a&&(a.preventDefault(),a.stopPropagation())}else(this.isFocused||"single"===this.settings.mode)&&this.items.length&&(0>b&&0===d.start&&0===d.length?h.push(this.items[this.caretPos-1]):0<b&&d.start===this.$control_input.val().length&&h.push(this.items[this.caretPos]));if(!h.length||"function"===typeof this.settings.onDelete&&!1===this.settings.onDelete.apply(this,[h]))return!1;for("undefined"!==typeof g&&this.setCaret(g);h.length;)this.removeItem(h.pop());this.showInput();this.positionDropdown();this.refreshOptions(!0);k&&(a=this.getOption(k),a.length&&this.setActiveOption(a));return!0},advanceSelection:function(a,b){var d,c;0!==a&&(this.rtl&&(a*=-1),d=0<a?"last":"first",c=A(this.$control_input[0]),this.isFocused&&!this.isInputHidden?
    (d=this.$control_input.val().length,(c=0>a?0===c.start&&0===c.length:c.start===d)&&!d&&this.advanceCaret(a,b)):(c=this.$control.children(".active:"+d),c.length&&(c=this.$control.children(":not(input)").index(c),this.setActiveItem(null),this.setCaret(0<a?c+1:c))))},advanceCaret:function(a,b){var d;0!==a&&(d=0<a?"next":"prev",this.isShiftDown?(d=this.$control_input[d](),d.length&&(this.hideInput(),this.setActiveItem(d),b&&b.preventDefault())):this.setCaret(this.caretPos+a))},setCaret:function(a){a= "single"===this.settings.mode?this.items.length:Math.max(0,Math.min(this.items.length,a));if(!this.isPending){var b,d,h,g;h=this.$control.children(":not(input)");b=0;for(d=h.length;b<d;b++)g=c(h[b]).detach(),b<a?this.$control_input.before(g):this.$control.append(g)}this.caretPos=a},lock:function(){this.close();this.isLocked=!0;this.refreshState()},unlock:function(){this.isLocked=!1;this.refreshState()},disable:function(){this.$input.prop("disabled",!0);this.$control_input.prop("disabled",!0).prop("tabindex", -1);this.isDisabled=!0;this.lock()},enable:function(){this.$input.prop("disabled",!1);this.$control_input.prop("disabled",!1).prop("tabindex",this.tabIndex);this.isDisabled=!1;this.unlock()},destroy:function(){var a=this.eventNS,b=this.revertSettings;this.trigger("destroy");this.off();this.$wrapper.remove();this.$dropdown.remove();this.$input.html("").append(b.$children).removeAttr("tabindex").removeClass("selectized").attr({tabindex:b.tabindex}).show();this.$control_input.removeData("grow");this.$input.removeData("selectize");
    c(window).off(a);c(document).off(a);c(document.body).off(a);delete this.$input[0].selectize},render:function(a,b){var d,c,g="",k=!1,q=/^[\t \r\n]*<([a-z][a-z0-9\-_]*(?:\:[a-z][a-z0-9\-_]*)?)/i;if("option"===a||"item"===a)d=f(b[this.settings.valueField]),k=!!d;if(k&&("undefined"===typeof this.renderCache[a]&&(this.renderCache[a]={}),this.renderCache[a].hasOwnProperty(d)))return this.renderCache[a][d];g=this.settings.render[a].apply(this,[b,u]);if("option"===a||"option_create"===a)g=g.replace(q,"<$1 data-selectable"); "optgroup"===a&&(c=b[this.settings.optgroupValueField]||"",g=g.replace(q,'<$1 data-group="'+E(u(c))+'"'));if("option"===a||"item"===a)g=g.replace(q,'<$1 data-value="'+E(u(d||""))+'"');k&&(this.renderCache[a][d]=g);return g},clearCache:function(a){"undefined"===typeof a?this.renderCache={}:delete this.renderCache[a]},canCreate:function(a){if(!this.settings.create)return!1;var b=this.settings.createFilter;return a.length&&("function"!==typeof b||b.apply(this,[a]))&&("string"!==typeof b||(new RegExp(b)).test(a))&&
    (!(b instanceof RegExp)||b.test(a))}});y.count=0;y.defaults={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:!1,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,maxOptions:1E3,maxItems:null,hideSelected:null,addPrecedence:!1,selectOnTab:!1,preload:!1,allowEmptyOption:!1,closeAfterSelect:!1,scrollDuration:60,loadThrottle:300,loadingClass:"loading",dataAttr:"data-data",optgroupField:"optgroup",valueField:"value",labelField:"text",optgroupLabelField:"label", optgroupValueField:"value",lockOptgroupOrder:!1,readOnly:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"selectize-control",inputClass:"selectize-input",dropdownClass:"selectize-dropdown",dropdownContentClass:"selectize-dropdown-content",dropdownParent:null,copyClassesToDropdown:!0,render:{}};c.fn.selectize=function(a){var b=c.fn.selectize.defaults,d=c.extend({},b,a),h=d.dataAttr,g=d.labelField,k=d.valueField,q=d.optgroupField,l=d.optgroupLabelField,e=d.optgroupValueField,
    m=function(a,b){var m,p,n,r,u=b.options,v={},w=function(a){a=h&&a.attr(h);return"string"===typeof a&&a.length?JSON.parse(a):null},x=function(a,h){a=c(a);var l=f(a.attr("value"));if(l||d.allowEmptyOption)if(v.hasOwnProperty(l)){if(h){var e=v[l][q];e?c.isArray(e)?e.push(h):v[l][q]=[e,h]:v[l][q]=h}}else e=w(a)||{},e[g]=e[g]||a.text(),e[k]=e[k]||l,e[q]=e[q]||h,v[l]=e,u.push(e),a.is(":selected")&&b.items.push(l)},y=function(a){var d,g,k;a=c(a);if(g=a.attr("label"))d=w(a)||{},d[l]=g,d[e]=g,b.optgroups.push(d); k=c("option",a);a=0;for(d=k.length;a<d;a++)x(k[a],g)};b.maxItems=a.attr("multiple")?null:1;r=a.children();m=0;for(p=r.length;m<p;m++)n=r[m].tagName.toLowerCase(),"optgroup"===n?y(r[m]):"option"===n&&x(r[m])};return this.each(function(){if(!this.selectize){var f=c(this),e=this.tagName.toLowerCase(),l=f.attr("placeholder")||f.attr("data-placeholder");l||d.allowEmptyOption||(l=f.children('option[value=""]').text());l={placeholder:l,options:[],optgroups:[],items:[]};if("select"===e)m(f,l);else{var q, n,p;if(e=f.attr(h))for(l.options=JSON.parse(e),e=0,q=l.options.length;e<q;e++)l.items.push(l.options[e][k]);else if(e=c.trim(f.val()||""),d.allowEmptyOption||e.length){n=e.split(d.delimiter);e=0;for(q=n.length;e<q;e++)p={},p[g]=n[e],p[k]=n[e],l.options.push(p);l.items=n}}new y(f,c.extend(!0,{},b,l,a))}})};c.fn.selectize.defaults=y.defaults;c.fn.selectize.support={validity:e};y.define("drag_drop",function(a){if(!c.fn.sortable)throw Error('The "drag_drop" plugin requires jQuery UI "sortable".');if("multi"===
    this.settings.mode){var b=this;b.lock=function(){var a=b.lock;return function(){var c=b.$control.data("sortable");c&&c.disable();return a.apply(b,arguments)}}();b.unlock=function(){var a=b.unlock;return function(){var c=b.$control.data("sortable");c&&c.enable();return a.apply(b,arguments)}}();b.setup=function(){var a=b.setup;return function(){a.apply(this,arguments);var e=b.$control.sortable({items:"[data-value]",forcePlaceholderSize:!0,disabled:b.isLocked,start:function(a,b){b.placeholder.css("width", b.helper.css("width"));e.css({overflow:"visible"})},stop:function(){e.css({overflow:"hidden"});var a=b.$activeItems?b.$activeItems.slice():null,d=[];e.children("[data-value]").each(function(){d.push(c(this).attr("data-value"))});b.setValue(d);b.setActiveItem(a)}})}}()}});y.define("dropdown_header",function(a){var b=this;a=c.extend({title:"Untitled",headerClass:"selectize-dropdown-header",titleRowClass:"selectize-dropdown-header-title",labelClass:"selectize-dropdown-header-label",closeClass:"selectize-dropdown-header-close", html:function(a){return'<div class="'+a.headerClass+'"><div class="'+a.titleRowClass+'"><span class="'+a.labelClass+'">'+a.title+'</span><a href="javascript:void(0)" class="'+a.closeClass+'">&times;</a></div></div>'}},a);b.setup=function(){var d=b.setup;return function(){d.apply(b,arguments);b.$dropdown_header=c(a.html(a));b.$dropdown.prepend(b.$dropdown_header)}}()});y.define("optgroup_columns",function(a){var b=this;a=c.extend({equalizeWidth:!0,equalizeHeight:!0},a);this.getAdjacentOption=function(a,b){var d=a.closest("[data-group]").find("[data-selectable]"),e=d.index(a)+b;return 0<=e&&e<d.length?d.eq(e):c()};this.onKeyDown=function(){var a=b.onKeyDown;return function(d){var c,e;if(!this.isOpen||37!==d.keyCode&&39!==d.keyCode)return a.apply(this,arguments);b.ignoreHover=!0;e=this.$activeOption.closest("[data-group]");c=e.find("[data-selectable]").index(this.$activeOption);e=37===d.keyCode?e.prev("[data-group]"):e.next("[data-group]");e=e.find("[data-selectable]");c=e.eq(Math.min(e.length-1,
    c));c.length&&this.setActiveOption(c)}}();var d=function(){var a,b=d.width,c=document;"undefined"===typeof b&&(a=c.createElement("div"),a.innerHTML='<div style="width:50px;height:50px;position:absolute;left:-50px;top:-50px;overflow:auto;"><div style="width:1px;height:100px;"></div></div>',a=a.firstChild,c.body.appendChild(a),b=d.width=a.offsetWidth-a.clientWidth,c.body.removeChild(a));return b},e=function(){var e,f,h,l;l=c("[data-group]",b.$dropdown_content);if((f=l.length)&&b.$dropdown_content.width()){if(a.equalizeHeight){for(e=h=0;e<f;e++)h=Math.max(h,l.eq(e).height());l.css({height:h})}a.equalizeWidth&&(h=b.$dropdown_content.innerWidth()-d(),e=Math.round(h/f),l.css({width:e}),1<f&&(e=h-e*(f-1),l.eq(f-1).css({width:e})))}};if(a.equalizeHeight||a.equalizeWidth)x.after(this,"positionDropdown",e),x.after(this,"refreshOptions",e)});y.define("remove_button",function(a){if("single"!==this.settings.mode){a=c.extend({label:"&times;",title:"Remove",className:"remove",append:!0},a);var b=this,d='<a href="javascript:void(0)" class="'+a.className+'" tabindex="-1" title="'+u(a.title)+'">'+a.label+"</a>";this.setup=function(){var e=b.setup;return function(){if(a.append){var f=b.settings.render.item;b.settings.render.item=function(a){var b=f.apply(this,arguments),c=b.search(/(<\/[^>]+>\s*)$/);return b.substring(0,c)+d+b.substring(c)}}e.apply(this,arguments);this.$control.on("click","."+a.className,function(a){a.preventDefault();b.isLocked||(a=c(a.currentTarget).parent(),b.setActiveItem(a),b.deleteSelection()&&b.setCaret(b.items.length))})}}()}}); y.define("restore_on_backspace",function(a){var b=this;a.text=a.text||function(a){return a[this.settings.labelField]};this.onKeyDown=function(){var c=b.onKeyDown;return function(b){var e;if(8===b.keyCode&&""===this.$control_input.val()&&!this.$activeItems.length&&(e=this.caretPos-1,0<=e&&e<this.items.length)){e=this.options[this.items[e]];this.deleteSelection(b)&&(this.setTextboxValue(a.text.apply(this,[e])),this.refreshOptions(!0));b.preventDefault();return}return c.apply(this,arguments)}}()});return y});